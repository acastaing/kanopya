<TMPL_INCLUDE NAME="header.tmpl">
<TMPL_INCLUDE NAME="menu.tmpl">
<style type="text/css">@import url(/css/permissions.css);</style>
<div id="content">
<h2>Permissions</h2>
<select id="entitychoice">
	<TMPL_LOOP NAME=entitychoice>
	<option value="<TMPL_VAR NAME=entity>" <TMPL_VAR NAME=selected>><TMPL_VAR NAME=entity></option>
	</TMPL_LOOP>
</select>
<hr />
<table id="permissions">
<tr>
<td class="c1">for :</td>
<td><select id="consumer">
	<TMPL_IF NAME=usersgroupslist>
		<option class="bold" value="">Users'Groups:</option>
		<TMPL_LOOP NAME=usersgroupslist>
		<option value="<TMPL_VAR NAME=entity_id> <TMPL_VAR NAME=entitytype>"><TMPL_VAR NAME=groups></option>
		</TMPL_LOOP>
	</TMPL_IF>
	
	<TMPL_IF NAME=userslist>
		<option class="bold" value="">Users:</option>
		<TMPL_LOOP NAME=userslist>
		<option value="<TMPL_VAR NAME=entity_id> <TMPL_VAR NAME=entitytype>"><TMPL_VAR NAME=user></option>
		</TMPL_LOOP>
	</TMPL_IF>
</select>
</td>
<td class="c1">on :</td>
<td>
<select id="consumed">
	<TMPL_IF NAME=groupslist>
		<option class="bold" value=""><TMPL_VAR NAME=entitytype>'Groups:</option>
		<TMPL_LOOP NAME=groupslist>
		<option value="<TMPL_VAR NAME=entity_id> <TMPL_VAR NAME=entitytype>"><TMPL_VAR NAME=groups></option>
		</TMPL_LOOP>
	</TMPL_IF>
	
	<TMPL_IF NAME=entitylist>
		<option class="bold" value=""><TMPL_VAR NAME=entitytype>:</option>
		<TMPL_LOOP NAME=entitylist>
		<option value="<TMPL_VAR NAME=entity_id> <TMPL_VAR NAME=entitytype>"><TMPL_VAR NAME=entity></option>
		</TMPL_LOOP>
	</TMPL_IF>
</select>
</td>


<td rowspan="2"><input id="viewset" type="button" value="view / set permissions" onclick="javascript:loadPermissions()"/></td>
</tr>
</table>
</div>
<script type="text/javascript">
function updateEntityType() {
	window.location = '/cgi/kanopya.cgi/permissions/view_selectactors?entitytype='+this.options[this.selectedIndex].value;
}

function updateButtonState() {
	var consumer = document.getElementById('consumer');
	var consumed = document.getElementById('consumed');
	var button = document.getElementById('viewset');
	if((! consumer.options.length) || (consumer.options[consumer.options.selectedIndex].value == '') ||
		(! consumed.options.length) ||  (consumed.options[consumed.options.selectedIndex].value == '')) {
		button.disabled = true;
	} else {
		button.disabled = false;
	}
}

function loadPermissions() {
	var url = '/cgi/kanopya.cgi/permissions/form_permissionsettings?';
	var consumer = document.getElementById('consumer');
	var consumed = document.getElementById('consumed');
	var consumertype = consumer.options[consumer.options.selectedIndex].value.split(' ')[1];
	var consumer_id = consumer.options[consumer.options.selectedIndex].value.split(' ')[0];
	var consumedtype = consumed.options[consumed.options.selectedIndex].value.split(' ')[1];
	var consumed_id = consumed.options[consumed.options.selectedIndex].value.split(' ')[0];
	url += 'consumertype=' + consumertype + '&consumer_id=' + consumer_id +'&consumedtype=' + consumedtype + '&consumed_id=' + consumed_id;
	openform(url, 'set permissions', 700, 500,'toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, directories=no, status=no');
}


document.getElementById('entitychoice').onchange = updateEntityType;
document.getElementById('consumed').onchange = updateButtonState;
document.getElementById('consumer').onchange = updateButtonState;
updateButtonState();


</script>
<TMPL_INCLUDE NAME="footer.tmpl">



