<config use_conf="test_conf" >
	<internalnetwork ip="10.0.0.0" mask="255.255.255.0" gateway="10.0.0.254"/>
	<user name="admin" password="admin" />
	
	<conf label='mcs_conf' time_step='20' period='86400' rrd_base_dir='/tmp/monitor/base' graph_dir='/tmp/monitor/graph'>

		<!--
			Define graph to generate
		-->
		<generate_graph time_step='20'>
			<graph targets='NODES,CLUSTERS' time_laps='1200,hour,day' set_label='cpu' ds_label='rawIdleCPU,rawUserCPU,rawSystCPU' percent='yes' graph_type='stack'/>
			<graph targets='NODES,CLUSTERS' time_laps='1200,hour,day' set_label='mem' ds_label='memAvail' graph_type='stack'/>
			<graph targets='NODES,CLUSTERS' time_laps='1200,hour,day' set_label='net' ds_label='IpDataReceived,InputDiscarded' />
			<graph targets='NODES,CLUSTERS' time_laps='1200,hour,day' set_label='apache_stat' ds_label='ALL' />
			<graph targets='NODES,CLUSTERS' time_laps='1200,hour,day' set_label='apache_stat_reqsec' ds_label='ALL' with_total='yes'/>
			<graph targets='NODES,CLUSTERS' time_laps='1200,hour,day' set_label='apache_stat_workers' ds_label='ALL' />
			<graph targets='CLUSTERS' type='nodecount' time_laps='1200,hour,day' />		
		</generate_graph>
		
		<node_states starting_max_time="120" stopping_max_time="60"/>
		
		<monitor set='mem'/>
		<monitor set='cpu'/>
		<monitor set='net'/>
		<monitor set='apache_stat'/>
		<monitor set='apache_stat_workers'/>
		<monitor set='apache_stat_reqsec'/>

	</conf>
	
	<!-- ########################################################################################################################### -->
	
	<conf label='test_conf' time_step='30' period='86400' rrd_base_dir='/var/cache/mcs/monitor/base' graph_dir='/tmp/monitor/graph'>
				
		<node_states starting_max_time="120" stopping_max_time="60"/>
		
		<monitor set='gen'/>
		<monitor set='iscsi'/>
		<monitor set='mem'/>
		<monitor set='cpu'/>
		<monitor set='iptable'/>
		<monitor set='io'/>
				
		<!--
			Define graph to generate
		-->
		<generate_graph time_step='40'>
			<graph targets='NODES,CLUSTERS'    time_laps='1200,hour,day' set_label='cpu' ds_label='ALL' percent='yes' graph_type='stack'/>
			<graph targets='NODES,CLUSTERS'    time_laps='1200,hour,day' set_label='io' ds_label='ALL'  />
			
			<!--graph targets='CLUSTERS'    time_laps='1200,hour,day' set_label='diskIOTable' ds_label='ALL' all_in_one='yes' /-->
			
			<!--graph targets='NODES,CLUSTERS'    time_laps='1200,hour,day' set_label='iptable' ds_label='ALL'  /-->
			<graph targets='NODES,CLUSTERS'    time_laps='1200,hour,day' set_label='iscsi' ds_label='ALL'  />
			
			<graph targets='NODES,CLUSTERS'    time_laps='1200,hour,day' set_label='gen' ds_label='gen_var4,gen_var5' percent='no' graph_type='line' with_total='yes'/>
			<graph targets='NODES,CLUSTERS' time_laps='1200,hour,day' set_label='mem' ds_label='memCached' graph_type='stack'/>
			<graph targets='CLUSTERS' type='nodecount' time_laps='1200,hour,day' />		
			
			
		</generate_graph>
				
	</conf>
	
	<!-- ################################################### Sets definition ####################################################### -->
	
	<!-- ######################## >
				TEST
	<    ######################## -->
	<set label='info' ds_type='COUNTER' data_provider='SnmpProvider' max="" >
		<ds label='IpOut' oid='.1.3.6.1.2.1.2.2.1.16.1' color='FF000055'/>
	</set>
	
	<!-- ######################## >
				Virtual
	<    ######################## -->	
	<set label='gen_counter' ds_type='COUNTER' data_provider='FuncProvider' max="" >
		<ds label="gen_var1" oid='' color='00FF00' />
		<ds label="gen_var2" oid='' color='00FF00' />
	</set>

	<set label='gen' ds_type='GAUGE' data_provider='FuncProvider' max="gen_var3" >
		<ds label="gen_var3" oid='' color='00FF00' />
		<ds label="gen_var4" oid='' color='FF0000' />
		<ds label="gen_var5" oid='' color='0000FF' />
	</set>	

	<!-- ######################## >
				ISCSI
	<    ######################## -->
	<set label='iscsi' table_oid='.1.3.6.1.3.1.1.1.6' ds_type='COUNTER' data_provider='SnmpProvider' component='Openiscsi' >
		<ds label="rx_octets" oid='17' color='00FF00' />
		<ds label="tx_octets" oid='30' color='FF0000' />
	</set>
	
	<!-- ######################## >
				MySQL
	<    ######################## -->
	<set label='mysql' ds_type='GAUGE' data_provider='MySqlProvider' max="" >
			<ds label="buffer_free" oid='Innodb_buffer_pool_pages_free' color='00FF00' />
	</set>

	<set label='mysql_counters' ds_type='COUNTER' data_provider='MySqlProvider' max="" >
		<ds label="slow_queries" oid='Slow_queries' color='FF0000' />
		<ds label="table_locks_waited" oid='Table_locks_waited' color='FFFF00' />
		<ds label="bytes_received" oid='Bytes_received' color='00FF00' />
	</set>
	
	<!-- ######################## >
				Memory
	<    ######################## -->
	<set label='mem' ds_type='GAUGE' data_provider='SnmpProvider' max="memTotal" >
		<ds label="memTotal" oid='.1.3.6.1.4.1.2021.4.5.0' color='FFFF0055' comm="total ram"/>
		<!--ds label="memFree" oid='.1.3.6.1.4.1.2021.4.11.0' color='00FFFF55' comm="free ram + free swap"/-->
		<!--ds label="AvailableSwap" oid='.1.3.6.1.4.1.2021.4.4.0' color='FF00FF55' /-->
		<ds label="memAvail" oid='.1.3.6.1.4.1.2021.4.6.0' color='00FF0055' comm="free ram"/>
		<ds label="memBuffered" oid='.1.3.6.1.4.1.2021.4.14.0' color='0000FF55' />
		<ds label="memCached" oid='.1.3.6.1.4.1.2021.4.15.0' color='FF000055' />
		<!-- ds label="ramShared" oid='.1.3.6.1.4.1.2021.4.13.0' comm="Not implemented on some hosts" /-->
	</set>
	
	<!-- ######################## >
				CPU
	<    ######################## -->
	<set label='cpu' ds_type='COUNTER' data_provider='SnmpProvider' max="User+Idle+Wait+Nice+Syst+Kernel+Interrupt" >
		<ds label='User' oid='.1.3.6.1.4.1.2021.11.50.0' color='FF000055'/>
		<ds label="Wait" oid='.1.3.6.1.4.1.2021.11.54.0' color='FF00FF55' />
		<ds label="Nice" oid='.1.3.6.1.4.1.2021.11.51.0' color='FFFF0055' />
		<ds label="Syst" oid='.1.3.6.1.4.1.2021.11.52.0' color='00FF0055' comm="sometimes implemented as 'ssCpuRawWait(54)' + 'ssCpuRawKernel(55)'" />
		<ds label="Kernel" oid='.1.3.6.1.4.1.2021.11.55.0' color='0000FF55' />
		<ds label="Interrupt" oid='.1.3.6.1.4.1.2021.11.56.0' color='66666655' />
		<ds label="Idle" oid='.1.3.6.1.4.1.2021.11.53.0' color='00FFFF55' />
	</set>
	
	<!-- ######################## >
				Apache
	<    ######################## -->
	<set label='apache_stat' ds_type='GAUGE' max="" data_provider='ApacheProvider' component='Apache'>
		<!--<ds label='Total_Accesses' oid='Total Accesses' color='FF0000'/>
		<ds label="Total_kBytes" oid='Total kBytes' color='00FFFF' /> -->
		<ds label="CPULoad" oid='CPULoad' color='FF00FF' />
		<ds label="ReqPerSec" oid='ReqPerSec' color='FFFF00' />
		<ds label="BytesPerSec" oid='BytesPerSec' color='00FF00' />
		<ds label="BytesPerReq" oid='BytesPerReq' color='0000FF' />
	</set>
	
	<set label='apache_stat_workers' ds_type='GAUGE' max="" data_provider='ApacheProvider' component='Apache'>
		<ds label="IdleWorkers" oid='IdleWorkers' color='00FF00' />
		<ds label="BusyWorkers" oid='BusyWorkers' color='FF0000' />
	</set>
	
	<set label='apache_stat_reqsec' ds_type='DERIVE' max="" data_provider='ApacheProvider' component='Apache'>
		<ds label="ReqPerSec" oid='Total Accesses' min='0' color='00FF00' />
	</set>
	
	<!-- ######################## >
				Net
	<    ######################## -->
	<set label='net' ds_type='COUNTER'>
		<ds label="IpDataReceived" oid='.1.3.6.1.2.1.4.31.1.1.3.1' color='00FF00' />
		
		<ds label="IpDataReceived2" oid='.1.3.6.1.2.1.4.31.1.1.3.2' color='00FF00' />
		
		<!--ds label="IpOctetReceived" oid='.1.3.6.1.2.1.4.31.1.1.5.1' color='FF0000' /-->
		<ds label="InputDiscarded" oid='.1.3.6.1.2.1.4.31.1.1.17.1' color='0000FF' />
		<ds label="IpDataDelivred" oid='.1.3.6.1.2.1.4.31.1.1.18.1' color='00FFFF' />
		
		<ds label="IpDataOutRequest" oid='.1.3.6.1.2.1.4.31.1.1.20.1' color='FF00FF' />
		<!--ds label="IpOctetOutReqest" oid='.1.3.6.1.2.1.4.31.1.1.32.1' color='FFFF00' /-->
	</set>
	
	<!--set label='net2' ds_type='GAUGE'>
		<ds label="IpSpeed" oid='.1.3.6.1.2.1.2.2.1.5' color='FF00FF' />
	</set-->
	
	<set label='iptable' table_oid='1.3.6.1.2.1.4.31.1' ds_type='COUNTER'>
		<ds label="IpDataReceived" oid='3' color='00FF00' />
		<ds label="IpDataOutRequest" oid='20' color='FF00FF' />
	</set>
	
	<!-- ######################## >
				Disk
	<    ######################## -->
	
	<!-- ###### See also ########
		dskTable: .1.3.6.1.4.1.2021.9 
	-->
	
	<set label='io' ds_type='COUNTER'>
		<ds label="IOSent" oid='.1.3.6.1.4.1.2021.11.57.0' color='0000FF' comm='Number of blocks sent to a block device'/>
		<ds label="IOReceive" oid='.1.3.6.1.4.1.2021.11.58.0' color='00FF00' comm='Number of blocks received from a block device'/>
	</set>
	
	<set label='diskIOTable' table_oid='1.3.6.1.4.1.2021.13.15.1' index_oid='2' ds_type='COUNTER'>
		<ds label="bytesRead" oid='3' color='00FF00' />
		<ds label="bytesWritten" oid='4' color='FF00FF' />
	</set>
	
</config>